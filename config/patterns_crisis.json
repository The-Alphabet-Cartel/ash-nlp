{
  "_metadata": {
    "file_version": "v3.1-3d-6-1",
    "last_modified": "2025-08-22",
    "clean_architecture": "v3.1 Compliant",
    "configuration_version": "3d.7",
    "description": "Enhanced crisis patterns mapped to existing environment variables - no new variables needed",
    "compliance": "Clean Architecture v3.1 Standards",
    "repository": "https://github.com/the-alphabet-cartel/ash-nlp",
    "community": "The Alphabet Cartel - https://discord.gg/alphabetcartel",
    "safety_notice": "These patterns detect life-threatening situations and require immediate professional response"
  },

  "patterns": {
    "hopelessness_patterns": {
      "crisis_level": "high",
      "category": "emotional_state",
      "description": "Patterns indicating deep hopelessness and despair",
      "patterns": [
        {
          "pattern": "no point in living",
          "type": "exact_match",
          "weight": 0.9,
          "urgency": "high",
          "auto_escalate": true
        },
        {
          "pattern": "nothing to live for",
          "type": "exact_match",
          "weight": 0.9,
          "urgency": "high",
          "auto_escalate": true
        },
        {
          "pattern": "everyone would be better off without me",
          "type": "exact_match",
          "weight": 0.7,
          "urgency": "high",
          "auto_escalate": true
        },
        {
          "pattern": "tired of fighting",
          "type": "exact_match",
          "weight": 0.7,
          "urgency": "medium",
          "auto_escalate": true
        },
        {
          "pattern": "can't do this anymore",
          "type": "exact_match",
          "weight": 0.7,
          "urgency": "medium",
          "auto_escalate": true
        },
        {
          "pattern": "\\b(give up|giving up)\\b",
          "type": "regex",
          "weight": 0.5,
          "urgency": "low",
          "auto_escalate": false
        },
        {
          "pattern": "feel hopeless",
          "type": "exact_match",
          "weight": 0.8,
          "urgency": "high",
          "auto_escalate": true
        },
        {
          "pattern": "want to kill myself",
          "type": "exact_match",
          "weight": 0.95,
          "urgency": "critical",
          "auto_escalate": true
        }
      ]
    },

    "isolation_patterns": {
      "crisis_level": "medium",
      "category": "social_withdrawal",
      "description": "Patterns indicating dangerous social isolation and withdrawal",
      "patterns": [
        {
          "pattern": "nobody cares about me",
          "type": "exact_match",
          "weight": 0.8,
          "urgency": "high",
          "context_required": true
        },
        {
          "pattern": "all alone in this",
          "type": "exact_match",
          "weight": 0.6,
          "urgency": "medium",
          "context_required": true
        },
        {
          "pattern": "no one understands",
          "type": "exact_match",
          "weight": 0.6,
          "urgency": "medium",
          "context_required": true
        },
        {
          "pattern": "\\b(isolated|disconnected)\\b.*\\b(everyone|world)\\b",
          "type": "regex",
          "weight": 0.4,
          "urgency": "low",
          "context_required": true
        }
      ]
    },

    "negation_patterns": {
      "crisis_level": "low",
      "category": "negation_modifiers", 
      "description": "Patterns that reduce crisis scores through negation or context",
      "patterns": [
        {
          "pattern": "\\b(not|never|don't|won't)\\s+(kill myself|hurt myself)\\b",
          "type": "regex",
          "weight": -0.6,
          "urgency": "low",
          "modifier": "reduction",
          "context_required": true
        },
        {
          "pattern": "\\bdon't worry\\b",
          "type": "regex",
          "weight": -0.3,
          "urgency": "low",
          "modifier": "reduction",
          "context_required": false
        },
        {
          "pattern": "\\bjust kidding\\b",
          "type": "regex",
          "weight": -0.4,
          "urgency": "low",
          "modifier": "reduction",
          "context_required": false
        }
      ]
    },

    "planning_indicators": {
      "crisis_level": "critical",
      "category": "planning",
      "description": "Indicators of crisis planning requiring immediate intervention",
      "patterns": [
        {
          "pattern": "made a plan",
          "type": "exact_match",
          "weight": 1.0,
          "urgency": "critical",
          "auto_escalate": true
        },
        {
          "pattern": "figured out how",
          "type": "exact_match",
          "weight": 0.9,
          "urgency": "critical",
          "auto_escalate": true
        },
        {
          "pattern": "writing goodbye",
          "type": "exact_match",
          "weight": 1.0,
          "urgency": "critical",
          "auto_escalate": true
        },
        {
          "pattern": "final arrangements",
          "type": "exact_match",
          "weight": 0.9,
          "urgency": "high",
          "auto_escalate": true
        },
        {
          "pattern": "saying goodbye",
          "type": "exact_match",
          "weight": 0.7,
          "urgency": "high",
          "auto_escalate": true
        },
        {
          "pattern": "getting affairs in order",
          "type": "exact_match",
          "weight": 0.9,
          "urgency": "high",
          "auto_escalate": true
        }
      ]
    },

    "method_references": {
      "crisis_level": "critical",
      "category": "method_discussion",
      "description": "References to specific methods requiring immediate escalation",
      "patterns": [
        {
          "pattern": "\\b(pills|overdose|medication)\\b.*\\b(take|swallow|consume)\\b",
          "type": "regex",
          "weight": 1.0,
          "urgency": "critical",
          "auto_escalate": true,
          "context_required": true
        },
        {
          "pattern": "\\b(bridge|building|height)\\b.*\\b(jump|leap|fall)\\b",
          "type": "regex",
          "weight": 1.0,
          "urgency": "critical",
          "auto_escalate": true,
          "context_required": true
        },
        {
          "pattern": "\\b(rope|hanging|noose)\\b",
          "type": "regex",
          "weight": 0.9,
          "urgency": "critical",
          "auto_escalate": true,
          "context_required": true
        },
        {
          "pattern": "\\b(gun|weapon|knife)\\b.*\\b(myself|me)\\b",
          "type": "regex",
          "weight": 1.0,
          "urgency": "critical",
          "auto_escalate": true,
          "context_required": true
        }
      ]
    }
  },

  "processing_rules": {
    "case_sensitive": false,
    "require_word_boundaries": true,
    "context_window": 10,
    "negation_processing": "apply_after_detection",
    "multiple_matches": "cumulative_scoring",
    "max_pattern_boost": 0.50,
    "defaults": {
      "case_sensitive": false,
      "require_word_boundaries": true,
      "context_window": 10,
      "negation_processing": "apply_after_detection",
      "multiple_matches": "cumulative_scoring",
      "max_pattern_boost": 0.50
    },
    "validation": {
      "context_window": {
        "range": [1, 50],
        "type": "integer"
      },
      "max_pattern_boost": {
        "range": [0.1, 2.0],
        "type": "float"
      },
      "negation_processing": {
        "choices": ["apply_after_detection", "apply_during_detection", "disabled"],
        "type": "string"
      },
      "multiple_matches": {
        "choices": ["cumulative_scoring", "highest_score", "average_score"],
        "type": "string"
      }
    }
  },

  "escalation_rules": {
    "auto_escalation_patterns": ["hopelessness_patterns", "planning_indicators", "method_references"],
    "staff_notification_required": true,
    "emergency_response_threshold": 0.80,
    "immediate_review_required": true,
    "escalation_delay_override": true,
    "notification_channels": ["staff", "emergency", "logging"],
    "defaults": {
      "auto_escalation_patterns": ["hopelessness_patterns", "planning_indicators", "method_references"],
      "staff_notification_required": true,
      "emergency_response_threshold": 0.80,
      "immediate_review_required": true,
      "escalation_delay_override": true,
      "notification_channels": ["staff", "emergency", "logging"]
    },
    "validation": {
      "emergency_response_threshold": {
        "range": [0.5, 1.0],
        "type": "float"
      },
      "auto_escalation_patterns": {
        "type": "array",
        "items": "string"
      },
      "notification_channels": {
        "type": "array",
        "items": "string",
        "allowed_values": ["staff", "emergency", "logging", "webhook"]
      }
    }
  },

  "pattern_defaults": {
    "description": "Default values for all pattern categories to ensure comprehensive fallbacks",
    "hopelessness_patterns": {
      "crisis_level": "high",
      "type": "exact_match",
      "weight_high": 0.9,
      "weight_medium": 0.7,
      "weight_low": 0.5,
      "urgency": "high",
      "urgency_medium": "medium",
      "urgency_low": "low",
      "auto_escalate": true,
      "auto_escalate_medium": true,
      "auto_escalate_low": false
    },
    "isolation_patterns": {
      "crisis_level": "medium",
      "type": "exact_match",
      "weight_high": 0.8,
      "weight_medium": 0.6,
      "weight_low": 0.4,
      "urgency": "high",
      "urgency_medium": "medium",
      "urgency_low": "low",
      "context_required": true
    },
    "negation_patterns": {
      "crisis_level": "low",
      "weight_high": -0.6,
      "weight_medium": -0.4,
      "weight_low": -0.3,
      "urgency": "low",
      "context_required": true,
      "context_required_false": false
    },
    "planning_indicators": {
      "crisis_level": "critical",
      "type": "exact_match",
      "weight_critical": 1.0,
      "weight_high": 0.9,
      "weight_medium": 0.7,
      "urgency_critical": "critical",
      "urgency_high": "high",
      "auto_escalate_critical": true,
      "auto_escalate_high": true
    },
    "method_references": {
      "crisis_level": "critical",
      "weight_critical": 1.0,
      "weight_high": 0.9,
      "urgency_critical": "critical",
      "auto_escalate_critical": true,
      "context_required": true
    }
  },

  "context_weights": {
    "description": "Context weight processing using existing environment variables",
    "crisis_amplifier": {
      "base_weight": 0.15,
      "max_boost": 0.35,
      "note": "Maps to existing NLP_ANALYSIS_CONTEXT_BOOST_WEIGHT and NLP_CONFIG_CRISIS_CONTEXT_BOOST_MULTIPLIER"
    },
    "positive_reducer": {
      "base_weight": -0.10,
      "max_reduction": -0.30,
      "note": "Uses safe defaults since no existing positive reduction variables"
    }
  },

  "environment_variable_mapping": {
    "description": "How this config maps to existing .env.template variables",
    "mappings": {
      "context_boost": "Uses NLP_ANALYSIS_CONTEXT_BOOST_WEIGHT=1.5",
      "crisis_boost": "Uses NLP_CONFIG_CRISIS_CONTEXT_BOOST_MULTIPLIER=1.0", 
      "thresholds": "Uses existing NLP_ANALYSIS_CRISIS_THRESHOLD_* variables",
      "enhanced_weight": "Uses NLP_CONFIG_ENHANCED_CRISIS_WEIGHT=1.2",
      "pattern_multiplier": "Uses NLP_ANALYSIS_PATTERN_WEIGHT_MULTIPLIER=1.2"
    },
    "no_new_variables_needed": true,
    "reuses_existing_infrastructure": true
  },

  "usage_instructions": {
    "integration": "Load via UnifiedConfigManager.get_patterns_crisis('patterns_crisis')",
    "access_method": "PatternDetectionManager.get_enhanced_patterns()",
    "environment_override_example": "Use existing variables like NLP_ANALYSIS_CONTEXT_BOOST_WEIGHT=2.0",
    "manager_method": "PatternDetectionManager.analyze_enhanced_patterns(message)",
    "defaults": {
      "integration": "Load via UnifiedConfigManager.get_patterns_crisis('patterns_crisis')",
      "access_method": "PatternDetectionManager.get_enhanced_patterns()",
      "environment_override_example": "Use existing NLP_ANALYSIS_* variables",
      "manager_method": "PatternDetectionManager.analyze_enhanced_patterns(message)"
    },
    "implementation_notes": [
      "Critical patterns should trigger immediate staff notification",
      "Method references require careful context validation to avoid false positives",
      "Negation patterns should be processed after initial crisis detection",
      "Planning indicators are among the highest risk signals and require urgent response",
      "All critical patterns should bypass normal escalation delays",
      "Pattern weights use direct values instead of environment variables to avoid resolution issues",
      "STEP 10.7: Removed environment variable dependencies to use existing infrastructure",
      "Uses existing .env.template variables where applicable, no new variables needed"
    ],
    "validation": {
      "integration": {
        "type": "string"
      },
      "access_method": {
        "type": "string"
      },
      "environment_override_example": {
        "type": "string"
      }
    }
  }
}